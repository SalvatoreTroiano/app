<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Workout Planner</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ea580c">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js');
    });
  }
</script>

<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4 sm:p-6">
  <div class="max-w-6xl mx-auto" id="app">
    <div class="bg-gradient-to-br from-orange-500 to-red-600 rounded-xl shadow-2xl p-4 sm:p-6 lg:p-8 mb-4 sm:mb-6">
      <h1 class="text-2xl sm:text-3xl lg:text-4xl font-black text-white mb-2 text-center tracking-tight">üí™ WORKOUT PLANNER</h1>
      <p class="text-sm sm:text-base text-orange-100 text-center font-semibold">Personal Training Program</p>
      <div class="grid sm:grid-cols-2 gap-4 sm:gap-6 mt-4 sm:mt-6">
        <div>
          <label class="block text-xs sm:text-sm font-bold text-white mb-2 uppercase tracking-wide">üèÉ Atleta</label>
          <input id="clientName" type="text" class="w-full px-3 py-2 sm:px-4 sm:py-3 bg-white/90 border-2 border-orange-300 rounded-lg focus:border-orange-400 focus:outline-none font-semibold text-base sm:text-lg" placeholder="Nome dell'atleta" />
        </div>
        <div>
          <label class="block text-xs sm:text-sm font-bold text-white mb-2 uppercase tracking-wide">üéØ Logo PT</label>
          <label for="logoInput" id="uploadLabel" class="flex items-center justify-center w-full px-3 py-2 sm:px-4 sm:py-3 bg-white/20 border-2 border-white/40 border-dashed rounded-lg cursor-pointer hover:bg-white/30 transition">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <span class="text-xs sm:text-sm text-white font-semibold ml-2">Upload Logo</span>
            <input id="logoInput" type="file" accept="image/*" class="hidden" />
          </label>
        </div>
      </div>
      <div id="logoPreviewWrap" class="hidden flex gap-4 sm:gap-6 mt-4 sm:mt-6 pt-4 sm:pt-6 border-t border-white/30">
        <div class="text-center mx-auto">
          <p class="text-xs sm:text-sm text-white font-semibold mb-2">Preview Logo</p>
          <img id="logoPreview" alt="Logo" class="max-w-24 sm:max-w-32 max-h-16 sm:max-h-20 mx-auto border-2 border-white/50 rounded bg-white/10 p-2" />
        </div>
      </div>
    </div>

    <div id="weeksContainer"></div>

    <div class="text-center mt-4 sm:mt-6">
      <button id="generatePDFBtn" class="inline-flex items-center gap-2 sm:gap-3 px-6 py-3 sm:px-10 sm:py-5 bg-gradient-to-r from-green-600 to-emerald-600 text-white text-base sm:text-xl font-black rounded-xl hover:from-green-700 hover:to-emerald-700 transition shadow-2xl uppercase tracking-wide">
        <svg width="20" height="20" class="sm:w-6 sm:h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Genera PDF
      </button>
    </div>
  </div>

<script>
// Dati iniziali
const state = {
  clientName: '',
  logo: '',
  weeks: [
    {
      id: 1,
      days: [
        { id: 1, name: 'Luned√¨', exercises: [] },
        { id: 2, name: 'Marted√¨', exercises: [] },
        { id: 3, name: 'Mercoled√¨', exercises: [] },
        { id: 4, name: 'Gioved√¨', exercises: [] },
        { id: 5, name: 'Venerd√¨', exercises: [] },
        { id: 6, name: 'Sabato', exercises: [] },
        { id: 7, name: 'Domenica', exercises: [] }
      ]
    }
  ]
};

const EXERCISE_LIBRARY = {
  mobility: [
    { name: "FOAM ROLLER" },
    { name: "SHOULDER" },
    { name: "LEG LOWER" },
    { name: "LEG LOWER RGR" },
    { name: "CUFFIE ROTATORI RNT" },
    { name: "ANKLE MOBILITY" },
    { name: "ANKLE MOBILITY LATERAL" },
    { name: "CAT COW" },
    { name: "TOE TOUCH" },
    { name: "SL DEADLIFT" },
    { name: "SUMO SQUAT" },
    { name: "LEG LOWER LATERAL" }
  ],
  strength: [
    { name: "PUSH UP"},
    { name: "BENCH PRESS" },
    { name: "BENCH PRESS BB" },
    { name: "CROCI" },
    { name: "SQUAT PRESS OUT" },
    { name: "GOBLET SOUAT" },
    { name: "BACK SQUAT" },
    { name: "ROW" },
    { name: "ROW BB" },
    { name: "ROW 1 ARM" },
    { name: "SL DEADLIFT" },
    { name: "TRAP BAR" },
    { name: "DEADLIFT KETBALL" },
    { name: "CURL" }
  ],
  core_power: [  
    { name: "PLANK" },
    { name: "SIDE PLANK" },
    { name: "HOLLOW HOLD" },
    { name: "DEAD BUG" },
    { name: "BIRD DOG" },
    { name: "RUSSIAN TWIST" },
    { name: "MOUNTAIN CLIMBERS" },
    { name: "JUMPING SQUAT" },
    { name: "BOX JUMP" },
    { name: "BURPEES" },
    { name: "MEDICINE BALL SLAM" },
    { name: "KETBALL SWING" }
  ]
};

const weeksContainer = document.getElementById('weeksContainer');
const clientNameInput = document.getElementById('clientName');
const logoInput = document.getElementById('logoInput');
const logoPreview = document.getElementById('logoPreview');
const logoPreviewWrap = document.getElementById('logoPreviewWrap');
const generatePDFBtn = document.getElementById('generatePDFBtn');

clientNameInput.addEventListener('input', (e) => {
  state.clientName = e.target.value;
});

logoInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    state.logo = ev.target.result;
    logoPreview.src = state.logo;
    logoPreviewWrap.classList.remove('hidden');
  };
  reader.readAsDataURL(file);
});

function createIconPlus() {
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('width','16'); svg.setAttribute('height','16'); svg.setAttribute('viewBox','0 0 24 24'); svg.setAttribute('fill','none'); svg.setAttribute('stroke','currentColor'); svg.setAttribute('stroke-width','2');
  const line1 = document.createElementNS('http://www.w3.org/2000/svg','line'); line1.setAttribute('x1','12'); line1.setAttribute('y1','5'); line1.setAttribute('x2','12'); line1.setAttribute('y2','19');
  const line2 = document.createElementNS('http://www.w3.org/2000/svg','line'); line2.setAttribute('x1','5'); line2.setAttribute('y1','12'); line2.setAttribute('x2','19'); line2.setAttribute('y2','12');
  svg.appendChild(line1); svg.appendChild(line2);
  return svg;
}

function createIconTrash() {
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('width','16'); svg.setAttribute('height','16'); svg.setAttribute('viewBox','0 0 24 24'); svg.setAttribute('fill','none'); svg.setAttribute('stroke','currentColor'); svg.setAttribute('stroke-width','2');
  const poly = document.createElementNS('http://www.w3.org/2000/svg','polyline'); poly.setAttribute('points','3 6 5 6 21 6');
  const path = document.createElementNS('http://www.w3.org/2000/svg','path'); path.setAttribute('d','M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2');
  const l1 = document.createElementNS('http://www.w3.org/2000/svg','line'); l1.setAttribute('x1','10'); l1.setAttribute('y1','11'); l1.setAttribute('x2','10'); l1.setAttribute('y2','17');
  const l2 = document.createElementNS('http://www.w3.org/2000/svg','line'); l2.setAttribute('x1','14'); l2.setAttribute('y1','11'); l2.setAttribute('x2','14'); l2.setAttribute('y2','17');
  svg.appendChild(poly); svg.appendChild(path); svg.appendChild(l1); svg.appendChild(l2);
  return svg;
}

function dayToDOM(weekIndex, dayIndex) {
  const day = state.weeks[weekIndex].days[dayIndex];
  const wrap = document.createElement('div');
  wrap.className = 'mb-6 sm:mb-8 pb-6 sm:pb-8 border-b border-slate-700 last:border-b-0';

  const header = document.createElement('div');
  header.className = 'flex justify-between items-center mb-3 sm:mb-4';
  const h3 = document.createElement('h3');
  h3.className = 'text-lg sm:text-xl font-black text-white uppercase tracking-wide';
  h3.textContent = day.name;

  header.appendChild(h3);
  wrap.appendChild(header);

  if (day.exercises.length === 0) {
    const p = document.createElement('p');
    p.className = 'text-slate-500 italic ml-2 sm:ml-4 font-semibold mb-3 sm:mb-4 text-sm sm:text-base';
    p.textContent = 'üí§ Giorno di riposo';
    wrap.appendChild(p);
  } else {
    const container = document.createElement('div');
    container.className = 'space-y-3 sm:space-y-4 mb-3 sm:mb-4';
    day.exercises.forEach((exercise, exIndex) => {
      const exWrap = document.createElement('div');
      exWrap.className = 'bg-slate-700 p-3 sm:p-4 rounded-lg border-l-4 border-orange-500 shadow-lg';
      const grid = document.createElement('div');
      grid.className = 'space-y-2';

      // --- Nome esercizio: select tipo + 2 select separate + input ---
    const nameContainer = document.createElement('div');
    nameContainer.className = 'flex flex-wrap sm:flex-nowrap gap-2';

    // SELECT TIPO ESERCIZIO (mobility / strength / power)
    const typeSelect = document.createElement('select');
    typeSelect.className = 'w-full sm:w-[110px] px-2 py-2 text-xs bg-slate-600 text-white border-2 border-slate-500 rounded focus:border-orange-500 focus:outline-none font-bold shrink-0';

    [
      { value: '', label: 'Nessun tipo' },
      { value: 'mobility', label: 'üßò MOBILITY' },
      { value: 'strength', label: 'üí™ STRENGTH' },
      { value: 'power', label: '‚ö° POWER' },
      { value: 'core_power', label: '‚ö° CORE/POWER' }
    ].forEach(optData => {
      const opt = document.createElement('option');
      opt.value = optData.value;
      opt.textContent = optData.label;
      if (exercise.type === optData.value) opt.selected = true;
      typeSelect.appendChild(opt);
    });

    typeSelect.addEventListener('change', (e) => {
      updateExercise(weekIndex, dayIndex, exIndex, 'type', e.target.value);
    });

    // PRIMA crea nameInput e gli altri input
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.value = exercise.name;
    nameInput.placeholder = 'Scrivi esercizio';
    nameInput.className = 'flex-1 min-w-[200px] px-3 py-2 text-sm bg-slate-600 text-white border-2 border-slate-500 rounded focus:border-orange-500 focus:outline-none font-semibold';

    nameInput.addEventListener('input', (e) => {
      updateExercise(weekIndex, dayIndex, exIndex, 'name', e.target.value);
    });

    // Dichiarazione anticipata degli altri input (serviranno nelle select)
    const setsInput = document.createElement('input');
    const repsInput = document.createElement('input');
    const restInput = document.createElement('input');
    const notesInput = document.createElement('input');

    // ADESSO crea le select mobility e strength
    // SELECT MOBILITY
    const mobilitySelect = document.createElement('select');
    mobilitySelect.className = 'w-full sm:max-w-[180px] px-2 py-2 text-sm bg-emerald-600 text-white border-2 border-emerald-500 rounded focus:border-emerald-400 focus:outline-none font-semibold';

    const emptyMobility = document.createElement('option');
    emptyMobility.value = '';
    emptyMobility.textContent = 'üßò Mobility';
    mobilitySelect.appendChild(emptyMobility);

    EXERCISE_LIBRARY.mobility.forEach((ex, i) => {
      const opt = document.createElement('option');
      opt.value = 'mobility-' + i;
      opt.textContent = ex.name;
      mobilitySelect.appendChild(opt);
    });

    mobilitySelect.addEventListener('change', (e) => {
      const value = e.target.value;
      if (!value) return;
      const [category, index] = value.split('-');
      const selected = EXERCISE_LIBRARY[category][index];
      if (!selected) return;
      
      nameInput.value = selected.name;
      setsInput.value = selected.sets || '';
      repsInput.value = selected.reps || '';
      restInput.value = selected.rest || '';
      notesInput.value = selected.notes || '';
      
      updateExercise(weekIndex, dayIndex, exIndex, 'name', selected.name);
      updateExercise(weekIndex, dayIndex, exIndex, 'type', category);
      renderWeeks();
    });

    // SELECT STRENGTH
    const strengthSelect = document.createElement('select');
    strengthSelect.className = 'w-full sm:max-w-[180px] px-2 py-2 text-sm bg-red-600 text-white border-2 border-red-500 rounded focus:border-red-400 focus:outline-none font-semibold';

    const emptyStrength = document.createElement('option');
    emptyStrength.value = '';
    emptyStrength.textContent = 'üí™ Strength';
    strengthSelect.appendChild(emptyStrength);

    EXERCISE_LIBRARY.strength.forEach((ex, i) => {
      const opt = document.createElement('option');
      opt.value = 'strength-' + i;
      opt.textContent = ex.name;
      strengthSelect.appendChild(opt);
    });

    strengthSelect.addEventListener('change', (e) => {
      const value = e.target.value;
      if (!value) return;
      const [category, index] = value.split('-');
      const selected = EXERCISE_LIBRARY[category][index];
      if (!selected) return;
      
      nameInput.value = selected.name;
      setsInput.value = selected.sets || '';
      repsInput.value = selected.reps || '';
      restInput.value = selected.rest || '';
      notesInput.value = selected.notes || '';
      
      updateExercise(weekIndex, dayIndex, exIndex, 'name', selected.name);
      updateExercise(weekIndex, dayIndex, exIndex, 'type', category);
      renderWeeks();
    });
    
    // SELECT CORE/POWER
      const corePowerSelect = document.createElement('select');
      corePowerSelect.className = 'w-full sm:max-w-[180px] px-2 py-2 text-sm bg-amber-600 text-white border-2 border-amber-500 rounded focus:border-amber-400 focus:outline-none font-semibold';

      const emptyCorePower = document.createElement('option');
      emptyCorePower.value = '';
      emptyCorePower.textContent = '‚ö° Core/Power';
      corePowerSelect.appendChild(emptyCorePower);

      EXERCISE_LIBRARY.core_power.forEach((ex, i) => {
        const opt = document.createElement('option');
        opt.value = 'core_power-' + i;
        opt.textContent = ex.name;
        corePowerSelect.appendChild(opt);
      });

      corePowerSelect.addEventListener('change', (e) => {
        const value = e.target.value;
        if (!value) return;
        const [category, index] = value.split('-');
        const selected = EXERCISE_LIBRARY[category][index];
        if (!selected) return;
        
        nameInput.value = selected.name;
        setsInput.value = selected.sets || '';
        repsInput.value = selected.reps || '';
        restInput.value = selected.rest || '';
        notesInput.value = selected.notes || '';
        
        updateExercise(weekIndex, dayIndex, exIndex, 'name', selected.name);
        updateExercise(weekIndex, dayIndex, exIndex, 'type', category);
        renderWeeks();
      });



    nameContainer.appendChild(typeSelect);
    nameContainer.appendChild(mobilitySelect);
    nameContainer.appendChild(strengthSelect);
    nameContainer.appendChild(corePowerSelect);
    nameContainer.appendChild(nameInput);
    
    

    // Riga per Serie, Ripetizioni, Recupero e Elimina
    const detailsContainer = document.createElement('div');
    detailsContainer.className = 'flex flex-wrap sm:flex-nowrap gap-2 items-center';

    // ORA configura gli input gi√† dichiarati
    setsInput.type = 'text';
    setsInput.value = exercise.sets;
    setsInput.placeholder = 'Serie';
    setsInput.className = 'flex-1 min-w-[80px] px-3 py-2 text-sm bg-slate-600 text-white border-2 border-slate-500 rounded focus:border-orange-500 focus:outline-none font-semibold';
    setsInput.addEventListener('input', (e) => updateExercise(weekIndex, dayIndex, exIndex, 'sets', e.target.value));

    repsInput.type = 'text';
    repsInput.value = exercise.reps;
    repsInput.placeholder = 'Rip.';
    repsInput.className = 'flex-1 min-w-[80px] px-3 py-2 text-sm bg-slate-600 text-white border-2 border-slate-500 rounded focus:border-orange-500 focus:outline-none font-semibold';
    repsInput.addEventListener('input', (e) => updateExercise(weekIndex, dayIndex, exIndex, 'reps', e.target.value));

    restInput.type = 'text';
    restInput.value = exercise.rest;
    restInput.placeholder = 'Recupero';
    restInput.className = 'flex-1 min-w-[100px] px-3 py-2 text-sm bg-slate-600 text-white border-2 border-slate-500 rounded focus:border-orange-500 focus:outline-none font-semibold';
    restInput.addEventListener('input', (e) => updateExercise(weekIndex, dayIndex, exIndex, 'rest', e.target.value));

    // ... resto del codice (trashBtn, notesInput, ecc.)

          const trashBtn = document.createElement('button');
          trashBtn.className = 'w-10 h-10 flex items-center justify-center bg-red-600 text-white rounded hover:bg-red-700 transition shrink-0';
          const trashIcon = createIconTrash();
          trashBtn.appendChild(trashIcon);
          trashBtn.addEventListener('click', () => removeExercise(weekIndex, dayIndex, exIndex));

          detailsContainer.appendChild(setsInput);
          detailsContainer.appendChild(repsInput);
          detailsContainer.appendChild(restInput);
          detailsContainer.appendChild(trashBtn);

          notesInput.type = 'text';  // <-- RIMUOVI const qui!
          notesInput.value = exercise.notes;
          notesInput.placeholder = 'üìù Note aggiuntive (tempo, tecnica, ecc.)';
          notesInput.className = 'w-full px-3 py-2 text-sm bg-slate-600 text-white border-2 border-slate-500 rounded focus:border-orange-500 focus:outline-none font-semibold placeholder-slate-400';
          notesInput.addEventListener('input', (e) => updateExercise(weekIndex, dayIndex, exIndex, 'notes', e.target.value));

          grid.appendChild(nameContainer);
          grid.appendChild(detailsContainer);
          grid.appendChild(notesInput);
          exWrap.appendChild(grid);
          container.appendChild(exWrap);
        });
        wrap.appendChild(container);
      }

      // Pulsante Aggiungi sempre in fondo centrato
      const addBtnContainer = document.createElement('div');
      addBtnContainer.className = 'flex justify-center';
      const addBtn = document.createElement('button');
      addBtn.className = 'flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold rounded-lg hover:from-orange-600 hover:to-red-700 transition shadow-lg uppercase text-xs sm:text-sm';
      addBtn.appendChild(createIconPlus());
      const span = document.createElement('span'); span.textContent = 'Aggiungi'; addBtn.appendChild(span);
      addBtn.addEventListener('click', () => {
        addExercise(weekIndex, dayIndex);
      });
      addBtnContainer.appendChild(addBtn);
      wrap.appendChild(addBtnContainer);

      return wrap;
    }

    function renderWeeks() {
      weeksContainer.innerHTML = '';
      state.weeks.forEach((week, weekIndex) => {
        const weekWrap = document.createElement('div');
        weekWrap.className = 'bg-slate-800 rounded-xl shadow-2xl p-4 sm:p-6 lg:p-8 mb-4 sm:mb-6 border-2 border-orange-500/30';

        const h2 = document.createElement('h2');
        h2.className = 'text-xl sm:text-2xl font-black text-orange-500 mb-4 sm:mb-6 uppercase tracking-wider flex items-center gap-2 sm:gap-3';
        h2.innerHTML = '<span class="text-2xl sm:text-3xl">üî•</span> Settimana ' + (weekIndex + 1);
        weekWrap.appendChild(h2);

        week.days.forEach((day, dayIndex) => {
          weekWrap.appendChild(dayToDOM(weekIndex, dayIndex));
        });

        weeksContainer.appendChild(weekWrap);
      });
    }

    function addExercise(weekIndex, dayIndex) {
      const newExercise = { id: Date.now(), name: '', sets: '', reps: '', rest: '', notes: '', type: '' };
      state.weeks[weekIndex].days[dayIndex].exercises.push(newExercise);
      renderWeeks();
    }

    function updateExercise(weekIndex, dayIndex, exerciseIndex, field, value) {
      state.weeks[weekIndex].days[dayIndex].exercises[exerciseIndex][field] = value;
    }

    function removeExercise(weekIndex, dayIndex, exerciseIndex) {
      state.weeks[weekIndex].days[dayIndex].exercises.splice(exerciseIndex, 1);
      renderWeeks();
    }

function generatePDFContent() {
  const logo = state.logo ? `<img src="${state.logo}" class="logo" alt="Logo">` : '';
  const clientName = state.clientName || '';
  const weeksHtml = state.weeks.map((week, wIndex) => {
   const daysHtml = week.days
  .filter(day => day.exercises.length > 0)
  .map(day => {

    const mobility = day.exercises.filter(ex => ex.type === 'mobility');
    const strength = day.exercises.filter(ex => ex.type === 'strength');
    const corePower = day.exercises.filter(ex => ex.type === 'core_power');
    const power = day.exercises.filter(ex => ex.type === 'power');
    const noType = day.exercises.filter(ex => !ex.type);

    const renderExercises = (list) =>
          list.map(ex => {
            const name = ex.name || 'Esercizio';
            const details = [];
            if (ex.sets) details.push('<strong>Serie:</strong> ' + ex.sets);
            if (ex.reps) details.push('<strong>Ripetizioni:</strong> ' + ex.reps);
            if (ex.rest) details.push('<strong>Recupero:</strong> ' + ex.rest);

            return `
              <div class="exercise">
                <div class="exercise-name">${name}</div>
                <div class="exercise-details">${details.join(' | ')}</div>
                ${ex.notes ? `<div class="exercise-notes">Note: ${ex.notes}</div>` : ''}
              </div>
            `;
          }).join('');

        return `
          <div class="day">
            <div class="day-name">${day.name}</div>

            ${mobility.length ? `
              <div class="section-title mobility">üßò MOBILITY</div>
              ${renderExercises(mobility)}
            ` : ''}

            ${strength.length ? `
              <div class="section-title strength">üí™ STRENGTH</div>
              ${renderExercises(strength)}
            ` : ''}

            ${power.length ? `
              <div class="section-title power">‚ö° POWER</div>
              ${renderExercises(power)}
            ` : ''}
            
            ${corePower.length ? `
              <div class="section-title core_power">‚ö° CORE/POWER</div>
              ${renderExercises(corePower)}
            ` : ''}


            ${noType.length ? `
              ${renderExercises(noType)}
            ` : ''}
          </div>
        `;
      }).join('');

    return `
    <div class="week">
      ${state.weeks.length > 1 ? `<div class="week-title">üî• SETTIMANA ${wIndex + 1}</div>` : ''}
      ${daysHtml}
    </div>`;
  }).join('');

  const html = `
  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8" />
    <title>Scheda Allenamento - ${clientName}</title>
    <style>
      @page { margin: 0.5cm; size: A4; }
      body { font-family: Arial, sans-serif; margin: 0; padding: 10px; font-size: 10px; page-break-before: avoid; }
      .header {
            display:flex;
            justify-content: space-between;
            align-items:center;
            margin-bottom:15px;
            background: linear-gradient(135deg, #8bc972 0%, #000000 100%);
            padding:12px;
            border-bottom: 3px solid #8bc972;
            page-break-before: avoid;
            page-break-after: avoid;
          }

      .logo { max-width:80px; max-height:50px; background:white; padding:5px; border-radius:4px; }
      .client-name { font-size:20px; font-weight:900; color:white; text-align:center; flex-grow:1; text-transform:uppercase; letter-spacing:1px; }
      .week { margin-bottom:12px; border:2px solid #8bc972; padding:8px; border-radius:6px; background:#fff7ed; page-break-inside: avoid; }
      .week-title { font-size:14px; font-weight:900; color:#8bc972; margin-bottom:8px; text-transform:uppercase; letter-spacing:0.5px; }
      .day { margin-bottom:10px; }
      .day-name { font-size:11px; font-weight:900; color:white; background: linear-gradient(135deg, #8bc972 0%, #000000 100%); padding:4px 8px; margin-bottom:5px; border-radius:3px; text-transform:uppercase; }
      .exercise { margin-left:10px; margin-bottom:5px; padding:5px 8px; background-color:white; border-left:3px solid #8bc972; border-radius:3px; display:flex; align-items:flex-start; gap:8px; }
      .exercise-name { font-weight:900; color:#1f2937; font-size:10px; margin-bottom:2px; text-transform:uppercase; }
      .exercise-details { color:#4b5563; font-size:9px; line-height:1.3; font-weight:600; }
      .exercise-notes { color:#6b7280; font-style:italic; font-size:8px; margin-top:2px; }
      .section-title {
        margin: 6px 0 4px;
        font-size: 10px;
        font-weight: 900;
        padding: 4px 6px;
        border-radius: 4px;
        text-transform: uppercase;
      }

      .section-title.mobility {
        background: #d1fae5;
        color: #065f46;
        border-left: 4px solid #10b981;
      }

      .section-title.strength {
        background: #fee2e2;
        color: #7f1d1d;
        border-left: 4px solid #ef4444;
      }

      .section-title.power {
        background: #fef3c7;
        color: #78350f;
        border-left: 4px solid #f59e0b;
      }
        .section-title.core_power {
          background: #fef3c7;
          color: #78350f;
          border-left: 4px solid #f59e0b;
        }

    </style>
  </head>
  <body>
    <div class="header">
      <div style="width:150px;">${logo}</div>
      <div class="client-name">PIANO ALLENAMENTO ${clientName ? '- ' + clientName.toUpperCase() : ''}</div>
      <div style="width:150px;"></div>
    </div>
    ${weeksHtml || '<p style="color:#6b7280;font-style:italic;">Nessun esercizio aggiunto.</p>'}
  </body>
  </html>`;

  return html;
}

generatePDFBtn.addEventListener('click', () => {
  const html = generatePDFContent();
  const printWindow = window.open('', '_blank');
  if (!printWindow) {
    alert('Popup bloccato: abilita i popup per generare il PDF.');
    return;
  }
  printWindow.document.write(html);
  printWindow.document.close();
  setTimeout(() => printWindow.focus() || printWindow.print(), 300);
});

// Render iniziale
renderWeeks();

</script>
</body>
</html>